@model List<CarRentalFrontEnd.Models.VehicleModel>
@{ var isAdmin = User.IsInRole("Admin"); }

<div class="dashboard-card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="card-title">@(ViewData["PageTitle"] ?? "Vehicle List")</h2>
        @if (isAdmin) {
            <a class="btn btn-success" href="@Url.Action("AddEdit", "Vehicle")">
                <i class="fas fa-plus me-2"></i>Add Vehicle
            </a>
        }
    </div>

    <div class="card-body p-4">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-3 p-3 mb-4">
                <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
            </div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 rounded-3 p-3 mb-4">
                <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
            </div>
        }

        <form id="vehicle-search-form" class="row g-3 mb-3">
            <div class="col-md-4">
                <input type="text" class="form-control" name="brand" placeholder="Search by brand" />
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" name="model" placeholder="Search by model" />
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" name="status" placeholder="Search by status" />
            </div>
            <div class="col-md-2 d-flex gap-2">
                <button type="submit" class="btn btn-primary flex-fill"><i class="fas fa-search"></i></button>
                <button type="button" id="clear-filters" class="btn btn-outline-danger border-2 rounded-pill px-3 shadow-sm flex-fill fw-semibold" title="Clear filters">
                    <i class="fas fa-times me-1"></i> Clear
                </button>
            </div>
        </form>

        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Year</th>
                        <th>Plate Number</th>
                        <th class="text-center">Status</th>
                        <th class="text-end">Mileage</th>
                        <th class="text-end">Price/Day</th>
                        @if (isAdmin) {<th class="text-nowrap">Created</th>; }
                        @if (isAdmin) { <th class="text-nowrap text-end">Actions</th>; }
                    </tr>
                </thead>
                <tbody id="vehicle-table-body">
                    @Html.Partial("_VehicleTable", Model)
                </tbody>
                <tfoot id="search-status" class="d-none">
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status" id="loading-indicator" style="display: none;">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div id="no-results-message" class="text-muted" style="display: none;">
                                <i class="fas fa-search me-2"></i>No vehicles found matching your search criteria.
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            $('#vehicle-search-form').on('submit', function (e) {
                e.preventDefault();
                var query = $(this).serialize();
                $('#loading-indicator').show();
                $.get(`/Vehicle/Search?${query}`, function (data) {
                    $('#vehicle-table-body').html(data);
                }).always(function() {
                    $('#loading-indicator').hide();
                });
            });

            $('#clear-filters').on('click', function(){
                const form = $('#vehicle-search-form')[0];
                form.reset();
                $('#vehicle-search-form').trigger('submit');
            });
        });
    </script>
}